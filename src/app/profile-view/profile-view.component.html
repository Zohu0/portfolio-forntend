<div class="container py-5">
  <div *ngIf="user; else loading">
    
    <!-- Profile Image Section -->
    <div class="text-center mb-4">
      <img
        [src]="'http://localhost:8080' + user.profileImageUrl"
        class="rounded-circle border border-2"
        alt="Profile Image"
        width="150"
        height="150"
      />
      <div class="mt-3">
        <label for="imageUpload" class="form-label">Update Profile Image</label>
        <input type="file" id="imageUpload" class="form-control w-auto mx-auto" (change)="onImageSelected($event)" />
      </div>
    </div>

    <!-- Header -->
    <h2 class="text-center mb-4">{{ user.fullName }}</h2>

    <!-- Basic Info -->
    <div class="card shadow-sm p-4 mb-4 position-relative">
      <h4 class="mb-3">Basic Info</h4>

      <form *ngIf="isEditing; else readMode" (ngSubmit)="submitUpdateBasicInfo()" #userForm="ngForm">
        <div class="mb-2">
          <label>Email</label>
          <input class="form-control" [(ngModel)]="editableUser.email" name="email" required />
        </div>
        <div class="mb-2">
          <label>Phone</label>
          <input class="form-control" [(ngModel)]="editableUser.phone" name="phone" required />
        </div>
        <div class="mb-2">
          <label>Address</label>
          <input class="form-control" [(ngModel)]="editableUser.address" name="address" />
        </div>
        <div class="mb-2">
          <label>About Me</label>
          <textarea class="form-control" [(ngModel)]="editableUser.aboutMe" name="aboutMe"></textarea>
        </div>
        <div class="d-flex justify-content-end mt-3">
          <button class="btn btn-sm btn-success" type="submit">Save</button>
          <button class="btn btn-sm btn-secondary ms-2" type="button" (click)="isEditing = false">Cancel</button>
        </div>
      </form>

      <ng-template #readMode>
        <p><strong>Email:</strong> {{ user.email }}</p>
        <p><strong>Phone:</strong> {{ user.phone }}</p>
        <p><strong>Address:</strong> {{ user.address }}</p>
        <p><strong>About Me:</strong> {{ user.aboutMe }}</p>
        <div class="d-flex justify-content-end mt-3">
          <button class="btn btn-sm btn-outline-success" (click)="onEditToggle()">Edit</button>
        </div>
      </ng-template>
    </div>

    <!-- Education -->
    <div class="card shadow-sm p-4 mb-4">
      <h4 class="mb-3">Education</h4>
      <ul *ngIf="educationList.length > 0; else noEducation" class="list-group list-group-flush">
        <li *ngFor="let edu of educationList" class="list-group-item">
          üéì <strong>{{ edu.degree }}</strong> at {{ edu.institution }}<br />
          <small>{{ edu.startYear }} - {{ edu.endYear }}</small>
        </li>
      </ul>
      <ng-template #noEducation>
        <p>No education records found.</p>
      </ng-template>
    </div>

    <!-- Experience -->
    <div class="card shadow-sm p-4 mb-4">
      <h4 class="mb-3">Experience</h4>
      <ul *ngIf="experienceList.length > 0; else noExperience" class="list-group list-group-flush">
        <li *ngFor="let exp of experienceList" class="list-group-item">
          üíº <strong>{{ exp.jobTitle }}</strong> at {{ exp.company }}<br />
          <small>{{ exp.startDate }} - {{ exp.endDate }}</small><br />
          {{ exp.description }}
        </li>
      </ul>
      <ng-template #noExperience>
        <p>No experience records found.</p>
      </ng-template>
    </div>

    <!-- Projects -->
    <div class="card shadow-sm p-4 mb-4">
      <h4 class="mb-3">Projects</h4>
      <ul *ngIf="projectList.length > 0; else noProject" class="list-group list-group-flush">
        <li *ngFor="let proj of projectList" class="list-group-item">
          üõ†Ô∏è <strong>{{ proj.title }}</strong><br />
          {{ proj.description }}<br />
          <small><strong>Technologies:</strong> {{ proj.technologiesUsed }}</small><br />
          <a [href]="proj.projectUrl" target="_blank">{{ proj.projectUrl }}</a>
        </li>
      </ul>
      <ng-template #noProject>
        <p>No project records found.</p>
      </ng-template>
    </div>

    <!-- Skills -->
    <div class="card shadow-sm p-4 mb-4">
      <h4 class="mb-3">Skills</h4>
      <ul *ngIf="skillList.length > 0; else noSkill" class="list-group list-group-flush">
        <li *ngFor="let skill of skillList" class="list-group-item">
          üß† <strong>{{ skill.name }}</strong> - {{ skill.level }}
        </li>
      </ul>
      <ng-template #noSkill>
        <p>No skill records found.</p>
      </ng-template>
    </div>
  </div>

  <!-- Loading -->
  <ng-template #loading>
    <div class="text-center">
      <div class="spinner-border text-primary mb-2" role="status"></div>
      <p>Loading user profile...</p>
    </div>
  </ng-template>
</div>
